<h1>Ajouter une dépense</h1>
<section>
    <form class="form-container" method="POST" action="index.php?route=create-expense" enctype="multipart/form-data">
        <input type="hidden" name="group_id" value="<?= htmlspecialchars($group_id, ENT_QUOTES, 'UTF-8') ?>">
        
        <label for="expense-title">Titre de la dépense</label>
        <input type="text" name="title" id="expense-title" required>
        
        <label for="expense-amount">Montant total</label>
        <input type="number" step="0.01" name="amount" id="expense-amount" required>
        
        <label for="receipt">Reçu (optionnel)</label>
        <input type="file" name="receipt" id="receipt" accept=".png, .jpg, .jpeg, .pdf">
        <input type="hidden" name="MAX_FILE_SIZE" value="1000000">
        
        <h2>Participants</h2>
        <table>
            <thead>
                <tr>
                    <th>Participant</th>
                    <th>Montant</th>
                </tr>
            </thead>
            <tbody>
                <?php if (!empty($members)) : ?>
                    <?php foreach ($members as $member) : ?>
                        <tr>
                            <td><?= htmlspecialchars($member['username'], ENT_QUOTES, 'UTF-8') ?></td>
                            <td>
                                <input type="number" step="0.01" name="participants[<?= htmlspecialchars($member['id'], ENT_QUOTES, 'UTF-8') ?>]" value="">
                            </td>
                        </tr>
                    <?php endforeach; ?>
                <?php else : ?>
                    <tr>
                        <td colspan="2">Aucun membre trouvé</td>
                    </tr>
                <?php endif; ?>
            </tbody>
        </table>
        
        <a href="#" id="split-equally">
            <p>Répartir équitablement</p>
            <i class="fas fa-calculator"></i>
        </a>
        
        <button type="submit" class="button">Ajouter la dépense</button>
    </form>
</section>

<script>
document.getElementById('split-equally').addEventListener('click', function(e) {
    e.preventDefault();
    
    const totalAmount = parseFloat(document.getElementById('expense-amount').value);
    if (isNaN(totalAmount)) {
        alert('Veuillez d\'abord entrer un montant total valide');
        return;
    }
    
    const participantInputs = document.querySelectorAll('input[name^="participants"]');
    const participantCount = participantInputs.length;
    
    if (participantCount === 0) {
        return;
    }
    
    const amountPerPerson = (totalAmount / participantCount).toFixed(2);
    
    participantInputs.forEach(input => {
        input.value = amountPerPerson;
    });
});
</script>